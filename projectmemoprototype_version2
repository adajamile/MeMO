import spotipy
from spotipy.oauth2 import SpotifyOAuth
import webbrowser

# Suas credenciais obtidas no Spotify Developer Dashboard
CLIENT_ID = '57202c8ae7024c3aac399499bfb026b1'
CLIENT_SECRET = '4c543f7bde714b68a681d03ebea209ad'
REDIRECT_URI = 'https://github.com/adajamile/MeMO.git'  
# Definir escopos que permitem o acesso às playlists e controle de dispositivos
scope = 'playlist-read-private user-modify-playback-state user-read-playback-state'

# Autenticação com OAuth
sp = spotipy.Spotify(auth_manager=SpotifyOAuth(client_id=CLIENT_ID,
                                               client_secret=CLIENT_SECRET,
                                               redirect_uri=REDIRECT_URI,
                                               scope=scope))

# Definir um volume fixo pro spotify
volume_percentage = 26  # Ajuste o volume desejado (0 a 100)
youtube_link = "https://youtu.be/A2_YmvHxVmA?si=YUWvgC_PObf21zui"

while True:
    # Pedir ao usuário para inserir o link da playlist
    playlist_link = input("Insira o link da playlist do Spotify ou digite 'sair' para encerrar: ")
    
    if playlist_link.lower() == 'sair':
        print("Encerrando o programa.")
        break

    # Extrair o ID da playlist
    playlist_id = playlist_link.split("/")[-1].split("?")[0]

    # Acessar informações da playlist
    playlist = sp.playlist(playlist_id)

    # Exibir o nome da playlist e faixas
    print(f"Nome da Playlist: {playlist['name']}")
    print("Faixas na playlist:")
    for idx, track in enumerate(playlist['tracks']['items']):
        print(f"{idx + 1}: {track['track']['name']} - {track['track']['artists'][0]['name']}")

    # Obter o dispositivo ativo (que está tocando música no momento)
    devices = sp.devices()
    if devices['devices']:
        active_device = devices['devices'][0]  # Seleciona o primeiro dispositivo ativo
        device_id = active_device['id']
        print(f"Dispositivo ativo: {active_device['name']}")

        # Ajustar o volume para o valor fixo
        sp.volume(volume_percentage, device_id=device_id)
        print(f"Volume ajustado para {volume_percentage}% no dispositivo '{active_device['name']}'")

        # Reproduzir a playlist
        sp.start_playback(context_uri=playlist['uri'], device_id=device_id)
        print(f"Reproduzindo a playlist: {playlist['name']}")

        # Abrir o link do YouTube no navegador
        webbrowser.open(youtube_link)
        print(f"Abrindo o vídeo do YouTube: {youtube_link}")
    else:
        print("Nenhum dispositivo ativo encontrado. Certifique-se de que o Spotify está tocando em algum dispositivo.")
